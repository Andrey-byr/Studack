#!/bin/bash

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd "/Users/andrejburak/Desktop/–ø—Ä–æ–µ–∫—Ç /Studack/merger"

echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–≥–æ –æ–±—â–µ–∂–∏—Ç–∏—è..."
echo "üìÅ –ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞: $(pwd)"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º PHP —Å–µ—Ä–≤–µ—Ä –≤ —Ñ–æ–Ω–µ
php -S localhost:8000 > server.log 2>&1 &
SERVER_PID=$!

# –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä —Ç–æ—á–Ω–æ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
sleep 2

echo "‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (PID: $SERVER_PID)"
echo "üåê –û—Ç–∫—Ä—ã–≤–∞—é –±—Ä–∞—É–∑–µ—Ä..."
echo ""

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
cleanup() {
    echo ""
    echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Å–µ—Ä–≤–µ—Ä (PID: $SERVER_PID)..."
    kill $SERVER_PID 2>/dev/null
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    exit 0
}

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
trap cleanup SIGINT SIGTERM

# –û—Ç–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
open "http://localhost:8000" &
BROWSER_PID=$!

echo "=========================================="
echo "–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç: http://localhost:8000"
echo "–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤: server.log"
echo "PID —Å–µ—Ä–≤–µ—Ä–∞: $SERVER_PID"
echo "=========================================="
echo ""

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–º –ø—Ä–æ—Ü–µ—Å—Å—ã –±—Ä–∞—É–∑–µ—Ä–∞
echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞..."
while true; do
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
    if ! ps -p $BROWSER_PID > /dev/null 2>&1; then
        echo "üåê –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Å–µ—Ä–≤–µ—Ä..."
        cleanup
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä
    if ! ps -p $SERVER_PID > /dev/null 2>&1; then
        echo "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è"
        exit 1
    fi
    
    sleep 2
done